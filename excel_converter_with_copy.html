<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Paste N20‚ÜíN10‚ÜíN30 Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.2em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding: 25px;
            min-height: 600px;
        }
        
        .section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .section h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }
        
        .copy-button {
            background: linear-gradient(135deg, #38b2ac, #319795);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(56, 178, 172, 0.3);
        }
        
        .copy-button.copied {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .paste-area {
            background: white;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .paste-area:hover, .paste-area:focus-within {
            border-color: #4299e1;
            background: #f7fafc;
        }
        
        .paste-area textarea {
            width: 100%;
            height: 150px;
            border: none;
            background: transparent;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
        }
        
        .paste-instructions {
            background: #e6fffa;
            border: 1px solid #38b2ac;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #234e52;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        button {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(66, 153, 225, 0.3);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        button.secondary:hover {
            box-shadow: 0 6px 12px rgba(72, 187, 120, 0.3);
        }
        
        .grid-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #cbd5e0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .grid-header {
            background: #edf2f7;
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            border-bottom: 2px solid #cbd5e0;
            font-weight: 600;
            color: #4a5568;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .grid-header div {
            padding: 12px 8px;
            text-align: center;
            border-right: 1px solid #cbd5e0;
            font-size: 12px;
        }
        
        .grid-header div:last-child {
            border-right: none;
        }
        
        .grid-row {
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s;
        }
        
        .grid-row:hover {
            background-color: #f7fafc;
        }
        
        .grid-row:last-child {
            border-bottom: none;
        }
        
        .grid-cell {
            padding: 8px;
            border-right: 1px solid #e2e8f0;
            min-height: 36px;
            display: flex;
            align-items: center;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .grid-cell:last-child {
            border-right: none;
        }
        
        .row-number {
            background: #f7fafc;
            font-weight: 600;
            color: #718096;
            justify-content: center;
            font-size: 11px;
        }
        
        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #cbd5e0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            height: 500px;
            position: relative;
        }
        
        .results-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .conversion-summary {
            background: #fff5f5;
            border: 1px solid #fc8181;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .conversion-summary h4 {
            margin: 0 0 10px 0;
            color: #c53030;
        }
        
        .conversion-summary ul {
            margin: 0;
            padding-left: 20px;
            font-size: 14px;
            color: #2d3748;
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .copy-notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä N20‚ÜíN10‚ÜíN30 Converter</h1>
            <p>Paste Excel data ‚Ä¢ N20√∑2=N10 (0.1m intervals) ‚Ä¢ Sum 300mm N10s=N30</p>
        </div>
        
        <div class="main-content">
            <div class="section">
                <h3>üìã Excel Data Input</h3>
                
                <div class="conversion-summary">
                    <h4>üîÑ Conversion Logic:</h4>
                    <ul>
                        <li><strong>N20 ‚Üí N10:</strong> Divide N20 by 2, create 0.1m intervals</li>
                        <li><strong>N10 ‚Üí N30:</strong> Sum 300mm (3 consecutive) N10 values</li>
                        <li><strong>Result:</strong> N30 values at 0.3m intervals</li>
                    </ul>
                </div>
                
                <div class="paste-instructions">
                    <strong>üìù Instructions:</strong> Copy data from Excel (2 columns: Distance, N20 Value) and paste below. 
                    Tab-separated, comma-separated, or space-separated formats accepted.
                </div>
                
                <div class="paste-area">
                    <textarea id="excelData" placeholder="Paste your Excel data here, e.g.:
0.2    27
0.4    21
0.6    17
0.8    9
1.0    6
...or copy directly from Excel"></textarea>
                </div>
                
                <div class="controls">
                    <button onclick="processData()">üîÑ Process Data</button>
                    <button class="secondary" onclick="loadSampleData()">üìã Load Sample</button>
                    <button class="secondary" onclick="clearData()">üóëÔ∏è Clear</button>
                </div>
                
                <div class="grid-container">
                    <div class="grid-header">
                        <div>#</div>
                        <div>Distance (m)</div>
                        <div>N20 Value</div>
                    </div>
                    <div id="inputGrid"></div>
                </div>
            </div>
            
            <div class="section">
                <h3>üìà Multi-Scale Visualization</h3>
                <div class="chart-container">
                    <canvas id="conversionChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="results-section">
            <div class="section">
                <h3 style="color: #4299e1;">
                    <span>üìä N10 Values (0.1m intervals)</span>
                    <button class="copy-button" onclick="copyN10Data()" id="copyN10Btn">
                        üìã Copy N10
                    </button>
                </h3>
                <div class="grid-container">
                    <div class="grid-header">
                        <div>#</div>
                        <div>Distance (m)</div>
                        <div>N10 = N20√∑2</div>
                    </div>
                    <div id="n10Grid"></div>
                </div>
            </div>
            
            <div class="section">
                <h3 style="color: #48bb78;">
                    <span>üìä N30 Values (0.3m intervals)</span>
                    <button class="copy-button" onclick="copyN30Data()" id="copyN30Btn">
                        üìã Copy N30
                    </button>
                </h3>
                <div class="grid-container">
                    <div class="grid-header">
                        <div>#</div>
                        <div>Distance (m)</div>
                        <div>N30 = Œ£(3√óN10)</div>
                    </div>
                    <div id="n30Grid"></div>
                </div>
            </div>
            
            <div class="section">
                <h3 style="color: #ed8936;">üìä Summary Comparison</h3>
                <div class="grid-container">
                    <div class="grid-header" style="grid-template-columns: 60px 80px 60px 60px 60px;">
                        <div>#</div>
                        <div>Dist (m)</div>
                        <div>N20</div>
                        <div>N10</div>
                        <div>N30</div>
                    </div>
                    <div id="summaryGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-notification" id="copyNotification">
        Data copied to clipboard! Ready to paste into Excel.
    </div>

    <script>
        let chart = null;
        let rawData = [];
        let n10Data = [];
        let n30Data = [];
        
        function parseExcelData(text) {
            const lines = text.trim().split('\n').filter(line => line.trim());
            const data = [];
            
            for (const line of lines) {
                // Try different separators: tab, comma, multiple spaces
                let parts = line.split('\t');
                if (parts.length < 2) {
                    parts = line.split(',');
                }
                if (parts.length < 2) {
                    parts = line.split(/\s+/);
                }
                
                if (parts.length >= 2) {
                    const distance = parseFloat(parts[0].trim());
                    const n20Value = parseFloat(parts[1].trim());
                    
                    if (!isNaN(distance) && !isNaN(n20Value)) {
                        data.push({ distance, n20Value });
                    }
                }
            }
            
            return data.sort((a, b) => a.distance - b.distance);
        }
        
        function interpolateN20ToN10(data) {
            if (data.length < 2) return [];
            
            const n10Results = [];
            
            // Find the range and create 0.1m intervals
            const minDist = Math.floor(data[0].distance * 10) / 10; // Round down to nearest 0.1
            const maxDist = Math.ceil(data[data.length - 1].distance * 10) / 10; // Round up to nearest 0.1
            
            for (let dist = minDist; dist <= maxDist; dist = Math.round((dist + 0.1) * 10) / 10) {
                // Find the N20 value at this distance (interpolate if needed)
                let n20Value = 0;
                
                // Find surrounding points
                let lowerPoint = null;
                let upperPoint = null;
                
                for (let i = 0; i < data.length; i++) {
                    if (data[i].distance <= dist) {
                        lowerPoint = data[i];
                    }
                    if (data[i].distance >= dist && !upperPoint) {
                        upperPoint = data[i];
                    }
                }
                
                if (lowerPoint && upperPoint) {
                    if (lowerPoint.distance === upperPoint.distance) {
                        n20Value = lowerPoint.n20Value;
                    } else {
                        // Linear interpolation
                        const ratio = (dist - lowerPoint.distance) / (upperPoint.distance - lowerPoint.distance);
                        n20Value = lowerPoint.n20Value + ratio * (upperPoint.n20Value - lowerPoint.n20Value);
                    }
                } else if (lowerPoint) {
                    n20Value = lowerPoint.n20Value;
                } else if (upperPoint) {
                    n20Value = upperPoint.n20Value;
                }
                
                // Convert N20 to N10 (divide by 2)
                const n10Value = n20Value / 2;
                
                n10Results.push({
                    distance: dist,
                    n20Value: n20Value,
                    n10Value: n10Value
                });
            }
            
            return n10Results;
        }
        
        function calculateN30FromN10(n10Data) {
            const n30Results = [];
            
            // Sum every 3 consecutive N10 values (300mm = 3 √ó 100mm)
            for (let i = 0; i <= n10Data.length - 3; i += 3) {
                const centerDistance = n10Data[i + 1].distance; // Use middle distance
                const n30Value = n10Data[i].n10Value + n10Data[i + 1].n10Value + n10Data[i + 2].n10Value;
                
                n30Results.push({
                    distance: centerDistance,
                    n30Value: n30Value,
                    contributingN10s: [
                        { dist: n10Data[i].distance, val: n10Data[i].n10Value },
                        { dist: n10Data[i + 1].distance, val: n10Data[i + 1].n10Value },
                        { dist: n10Data[i + 2].distance, val: n10Data[i + 2].n10Value }
                    ]
                });
            }
            
            return n30Results;
        }
        
        function copyN10Data() {
            if (n10Data.length === 0) {
                alert('No N10 data to copy. Please process some data first.');
                return;
            }
            
            // Create header row
            let csvContent = "Distance (m)\tN10 Value\n";
            
            // Add data rows
            n10Data.forEach(item => {
                csvContent += `${item.distance.toFixed(1)}\t${item.n10Value.toFixed(3)}\n`;
            });
            
            // Copy to clipboard
            navigator.clipboard.writeText(csvContent).then(() => {
                showCopyNotification();
                animateButton('copyN10Btn');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy data to clipboard. Please try again.');
            });
        }
        
        function copyN30Data() {
            if (n30Data.length === 0) {
                alert('No N30 data to copy. Please process some data first.');
                return;
            }
            
            // Create header row
            let csvContent = "Distance (m)\tN30 Value\n";
            
            // Add data rows
            n30Data.forEach(item => {
                csvContent += `${item.distance.toFixed(1)}\t${item.n30Value.toFixed(3)}\n`;
            });
            
            // Copy to clipboard
            navigator.clipboard.writeText(csvContent).then(() => {
                showCopyNotification();
                animateButton('copyN30Btn');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy data to clipboard. Please try again.');
            });
        }
        
        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }
        
        function animateButton(buttonId) {
            const button = document.getElementById(buttonId);
            const originalText = button.innerHTML;
            
            button.innerHTML = '‚úÖ Copied!';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('copied');
            }, 1500);
        }
        
        function processData() {
            const input = document.getElementById('excelData').value;
            if (!input.trim()) {
                alert('Please paste some data first!');
                return;
            }
            
            try {
                // Parse the pasted data
                rawData = parseExcelData(input);
                
                if (rawData.length === 0) {
                    alert('No valid data found. Please check your format.');
                    return;
                }
                
                // Convert N20 to N10 with 0.1m intervals
                n10Data = interpolateN20ToN10(rawData);
                
                // Calculate N30 from N10
                n30Data = calculateN30FromN10(n10Data);
                
                // Update all displays
                updateInputGrid();
                updateN10Grid();
                updateN30Grid();
                updateSummaryGrid();
                updateChart();
                
            } catch (error) {
                alert('Error processing data: ' + error.message);
            }
        }
        
        function updateInputGrid() {
            const grid = document.getElementById('inputGrid');
            grid.innerHTML = '';
            
            rawData.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'grid-row';
                row.innerHTML = `
                    <div class="grid-cell row-number">${index + 1}</div>
                    <div class="grid-cell">${item.distance.toFixed(1)}</div>
                    <div class="grid-cell">${item.n20Value.toFixed(1)}</div>
                `;
                grid.appendChild(row);
            });
        }
        
        function updateN10Grid() {
            const grid = document.getElementById('n10Grid');
            grid.innerHTML = '';
            
            n10Data.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'grid-row';
                row.innerHTML = `
                    <div class="grid-cell row-number">${index + 1}</div>
                    <div class="grid-cell">${item.distance.toFixed(1)}</div>
                    <div class="grid-cell">${item.n10Value.toFixed(2)}</div>
                `;
                grid.appendChild(row);
            });
        }
        
        function updateN30Grid() {
            const grid = document.getElementById('n30Grid');
            grid.innerHTML = '';
            
            n30Data.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'grid-row';
                row.innerHTML = `
                    <div class="grid-cell row-number">${index + 1}</div>
                    <div class="grid-cell">${item.distance.toFixed(1)}</div>
                    <div class="grid-cell">${item.n30Value.toFixed(2)}</div>
                `;
                grid.appendChild(row);
            });
        }
        
        function updateSummaryGrid() {
            const grid = document.getElementById('summaryGrid');
            grid.innerHTML = '';
            
            // Create a combined view showing aligned data
            const maxRows = Math.max(rawData.length, n10Data.length, n30Data.length);
            
            for (let i = 0; i < maxRows; i++) {
                const row = document.createElement('div');
                row.className = 'grid-row';
                row.style.gridTemplateColumns = '60px 80px 60px 60px 60px';
                
                const n20Item = rawData[i];
                const n10Item = n10Data[i * 2]; // Approximate alignment
                const n30Item = n30Data[Math.floor(i / 3)]; // Approximate alignment
                
                row.innerHTML = `
                    <div class="grid-cell row-number">${i + 1}</div>
                    <div class="grid-cell">${n20Item ? n20Item.distance.toFixed(1) : '-'}</div>
                    <div class="grid-cell">${n20Item ? n20Item.n20Value.toFixed(1) : '-'}</div>
                    <div class="grid-cell">${n10Item ? n10Item.n10Value.toFixed(2) : '-'}</div>
                    <div class="grid-cell">${n30Item ? n30Item.n30Value.toFixed(2) : '-'}</div>
                `;
                grid.appendChild(row);
            }
        }
        
        function updateChart() {
            if (!chart) {
                initChart();
                return;
            }
            
            chart.data.datasets[0].data = rawData.map(d => ({x: d.distance, y: d.n20Value}));
            chart.data.datasets[1].data = n10Data.map(d => ({x: d.distance, y: d.n10Value}));
            chart.data.datasets[2].data = n30Data.map(d => ({x: d.distance, y: d.n30Value}));
            
            chart.update();
        }
        
        function initChart() {
            const ctx = document.getElementById('conversionChart').getContext('2d');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'N20 (Original 0.2m)',
                            data: [],
                            borderColor: '#e53e3e',
                            backgroundColor: 'rgba(229, 62, 62, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: 'N10 (0.1m intervals)',
                            data: [],
                            borderColor: '#4299e1',
                            backgroundColor: 'rgba(66, 153, 225, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3,
                            pointRadius: 3,
                            pointHoverRadius: 5
                        },
                        {
                            label: 'N30 (0.3m sums)',
                            data: [],
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            borderWidth: 4,
                            fill: false,
                            tension: 0.2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'N20 ‚Üí N10 ‚Üí N30 Conversion Chart',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Distance (m)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Values (N20/N10/N30)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        function loadSampleData() {
            const sampleData = `0.2	27
0.4	21
0.6	17
0.8	9
1.0	6
1.2	6
1.4	4
1.6	5
1.8	4
2.0	4
2.2	4
2.4	4
2.6	4
2.8	4
3.0	5
3.2	5
3.4	4
3.6	5
3.8	6
4.0	6
4.2	6
4.4	6
4.6	7
4.8	6
5.0	9
5.2	10
5.4	9
5.6	9
5.8	6
6.0	6
6.2	7
6.4	9
6.6	5
6.8	7
7.0	6`;
            
            document.getElementById('excelData').value = sampleData;
            processData();
        }
        
        function clearData() {
            document.getElementById('excelData').value = '';
            document.getElementById('inputGrid').innerHTML = '';
            document.getElementById('n10Grid').innerHTML = '';
            document.getElementById('n30Grid').innerHTML = '';
            document.getElementById('summaryGrid').innerHTML = '';
            rawData = [];
            n10Data = [];
            n30Data = [];
            if (chart) {
                chart.data.datasets.forEach(dataset => dataset.data = []);
                chart.update();
            }
        }
        
        // Initialize
        window.addEventListener('load', function() {
            initChart();
            loadSampleData();
        });
    </script>
</body>
</html>